---
id: task-0014
title: Pie/Donut Chart Components with Interactive Features
description: Create interactive pie and donut chart components for part-to-whole learning analytics with drill-down capabilities and responsive design
assignee: developer-a-frontend
status: To Do
labels: phase-2, d3js, pie-chart, donut-chart, interactive, drill-down
created_date: 2025-08-25
updated_date: 2025-08-25
dependencies: task-0011
priority: Medium
estimate: 3 days
parent_epic: task-0010
---

# Pie/Donut Chart Components with Interactive Features

## Description
Build interactive pie and donut chart components optimized for displaying categorical learning analytics data with part-to-whole relationships. Components will support certification status distributions, course category breakdowns, and program enrollment patterns across Kineo's multi-tenant platform.

**Business Value**: Provides intuitive visualization of categorical data distributions, enabling quick identification of dominant categories, completion status breakdowns, and resource allocation insights for learning programs.

## Acceptance Criteria
- [ ] `PieChart` component with full circle visualization
- [ ] `DonutChart` component with customizable inner radius and center content
- [ ] Interactive slice selection with hover effects and click handlers
- [ ] Smooth arc transitions for data updates and animations
- [ ] Responsive sizing with mobile-optimized label positioning
- [ ] Drill-down functionality for hierarchical data exploration
- [ ] Legend integration with slice highlighting and toggle functionality
- [ ] Accessibility compliance with proper ARIA descriptions for each slice
- [ ] Customizable color schemes with automatic contrast optimization
- [ ] Data label options (percentages, values, or both) with smart positioning
- [ ] Small slice handling with "Others" grouping functionality
- [ ] Loading states and smooth transitions between data sets

## Implementation Notes
**Chart Variants**:
- **Simple Pie**: Basic pie chart for categorical data distribution
- **Donut Chart**: Ring chart with center content area for summary statistics
- **Semi-Circle**: Half-pie for gauge-like progress visualization
- **Nested Donut**: Multiple rings for hierarchical data (e.g., categories â†’ subcategories)

**Learning Analytics Use Cases**:
- Certification status distribution (Active, Expired, Pending, Not Assigned)
- Course completion status breakdown across different programs
- Learning category distribution (Compliance, Professional Development, Technical Skills)
- Employee engagement levels by department or region
- Training method preferences (E-learning, Classroom, Blended)

**Interactive Features**:
```typescript
interface PieInteractionConfig {
  enableHover: boolean;        // Slice highlighting on hover
  enableClick: boolean;        // Click handlers for drill-down
  explodeOnHover: boolean;     // Slice separation effect
  explodeDistance: number;     // Pixels to separate exploded slice
  showTooltips: boolean;       // Rich hover tooltips
  allowSliceToggle: boolean;   // Hide/show slices via legend
}
```

**Responsive Design Strategy**:
- Desktop: Full labels, larger radius, detailed tooltips
- Tablet: Abbreviated labels, medium radius, compact tooltips  
- Mobile: Minimal labels, smaller radius, simplified interactions
- Smart label collision detection and repositioning

## Dependencies
- **Requires**: Base Chart Architecture (task-0011) for core hooks and TypeScript interfaces
- **Uses**: D3.js arc generators, pie layout, transitions, and color scales
- **Integrates**: Theme system, responsive utilities, and tooltip components

## Related Tasks
- **Epic**: D3.js Chart Component Library Foundation (task-0010)  
- **Parallel**: Bar/Column Charts (task-0012), Line/Area Charts (task-0013)
- **Next**: Chart Library Testing and Documentation (task-0015)

## Detailed Implementation Steps

### 1. Core Component Architecture
```typescript
interface PieChartProps {
  data: PieDataPoint[];
  config: PieChartConfig;
  variant: 'pie' | 'donut' | 'semi-circle';
  centerContent?: React.ReactNode; // For donut charts
  onSliceClick?: (slice: PieDataPoint, index: number) => void;
  onSliceHover?: (slice: PieDataPoint | null) => void;
}

interface PieDataPoint {
  id: string;
  label: string;
  value: number;
  color?: string;
  metadata?: Record<string, any>;
}

interface PieChartConfig extends ChartConfig {
  innerRadius?: number;        // 0 for pie, >0 for donut
  outerRadius?: number;        // Auto-calculated from container
  padAngle?: number;           // Space between slices
  cornerRadius?: number;       // Rounded slice corners
  startAngle?: number;         // Rotation offset
  sortSlices?: boolean;        // Sort by value desc
  showLabels?: boolean;        // External labels
  showValues?: boolean;        // Show values/percentages
  minSlicePercent?: number;    // Threshold for "Others" grouping
}
```

### 2. D3.js Arc Generation
```typescript
// Arc generator with responsive sizing
const arcGenerator = d3.arc()
  .innerRadius(config.innerRadius || 0)
  .outerRadius(config.outerRadius || radius)
  .cornerRadius(config.cornerRadius || 0);

// Pie layout for data transformation
const pieLayout = d3.pie<PieDataPoint>()
  .value(d => d.value)
  .sort(config.sortSlices ? (a, b) => b.value - a.value : null)
  .padAngle(config.padAngle || 0)
  .startAngle(config.startAngle || 0);
```

### 3. Animation Framework
- **Enter Animation**: Slices grow from center with staggered timing
- **Update Animation**: Smooth arc morphing between data changes
- **Exit Animation**: Slices shrink to center before removal
- **Hover Animation**: Smooth explode/implode effects with elastic easing

### 4. Interactive Features Implementation

#### Slice Hover Effects
- Highlight hovered slice with opacity and stroke changes
- Explode slice outward with smooth transition
- Show rich tooltip with formatted data and context
- Update center content for donut charts

#### Click Handlers and Drill-Down
```typescript
const handleSliceClick = (slice: PieDataPoint, index: number) => {
  if (config.enableDrillDown && slice.metadata?.hasChildren) {
    // Load child data and update chart
    onSliceClick?.(slice, index);
  } else {
    // Simple selection or navigation
    setSelectedSlice(slice);
  }
};
```

### 5. Smart Label Positioning
```typescript
// Label positioning with collision detection
const positionLabels = (arcs: d3.PieArcDatum<PieDataPoint>[]) => {
  const labelRadius = outerRadius + 20;
  const labels = arcs.map(arc => ({
    arc,
    x: Math.cos(arc.startAngle + (arc.endAngle - arc.startAngle) / 2) * labelRadius,
    y: Math.sin(arc.startAngle + (arc.endAngle - arc.startAngle) / 2) * labelRadius,
  }));
  
  // Collision detection and adjustment logic
  return adjustLabelPositions(labels);
};
```

### 6. Small Slice Handling
- Automatically group slices below configurable threshold into "Others"
- Provide drill-down to see grouped items
- Smart color selection for grouped slice
- Tooltip showing count of grouped items

### 7. Center Content for Donut Charts
```typescript
interface DonutCenterProps {
  totalValue?: number;
  selectedSlice?: PieDataPoint;
  formatter?: (value: number) => string;
  showPercentage?: boolean;
}

const DonutCenter: React.FC<DonutCenterProps> = ({ 
  totalValue, 
  selectedSlice, 
  formatter 
}) => {
  return (
    <div className="absolute inset-0 flex items-center justify-center">
      <div className="text-center">
        {selectedSlice ? (
          <>
            <div className="text-2xl font-bold text-gray-900 dark:text-gray-100">
              {formatter?.(selectedSlice.value) || selectedSlice.value}
            </div>
            <div className="text-sm text-gray-600 dark:text-gray-400">
              {selectedSlice.label}
            </div>
          </>
        ) : (
          <div className="text-3xl font-bold text-gray-900 dark:text-gray-100">
            {formatter?.(totalValue || 0) || totalValue}
          </div>
        )}
      </div>
    </div>
  );
};
```

### 8. Legend Integration
- Interactive legend with slice highlighting
- Click to toggle slice visibility
- Responsive legend positioning (side, bottom, or hidden on mobile)
- Color swatches with proper accessibility contrast

### 9. Accessibility Implementation
- Proper ARIA labels for each slice with percentage and value
- Keyboard navigation support (Tab, Arrow keys, Enter, Space)
- Screen reader descriptions for chart summary and individual slices
- High contrast mode support with stroke outlines

## Testing Strategy
- **Unit Tests**: Arc calculations, data transformations, interaction handlers
- **Integration Tests**: Legend interactions, drill-down functionality, responsive behavior
- **Visual Tests**: Animation smoothness, label positioning, color contrast
- **Accessibility Tests**: Keyboard navigation, screen reader compatibility
- **Performance Tests**: Large dataset handling, animation performance

## Storybook Documentation
- Interactive stories for all chart variants (pie, donut, semi-circle)
- Data generators for consistent testing scenarios
- Animation and interaction playground
- Accessibility demonstration stories
- Responsive behavior examples

## Success Metrics
- Smooth 60fps animations for all interactions
- <150ms render time for up to 20 slices
- 100% accessibility compliance verification
- Zero layout shifts during responsive changes
- Clear visual hierarchy and intuitive interactions